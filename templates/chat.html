{% extends 'base.html' %}
{% block title %}Chat General{% endblock %}
{% block content %}
<div class="container mt-5">
    <h2>Chat General</h2>
    <div id="chat-box" style="height:350px; overflow-y:auto; border:1px solid #ccc; padding:10px; background:#f8f9fa;"></div>
    <form id="chat-form" class="mt-3">
        <div class="input-group">
            <input type="text" id="chat-message" class="form-control" placeholder="Escribe tu mensaje..." autocomplete="off" required>
            <button class="btn btn-primary" type="submit">Enviar</button>
        </div>
    </form>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
<script>
    var socket = io();
    var username = "{{ username }}";
    var chatBox = document.getElementById('chat-box');
    var chatForm = document.getElementById('chat-form');
    var chatInput = document.getElementById('chat-message');

    socket.on('receive_message', function(data) {
        var msg = document.createElement('div');
        msg.innerHTML = '<b>' + data.username + ':</b> ' + data.message;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    chatForm.onsubmit = function(e) {
        e.preventDefault();
        var message = chatInput.value.trim();
        if(message) {
            socket.emit('send_message', {username: username, message: message});
            chatInput.value = '';
        }
    };
</script>
{% endblock %}
